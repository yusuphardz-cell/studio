/**
 * This ruleset governs the Pool Game application's Firestore database.
 *
 * Core Philosophy:
 * The security model is designed for public read access. Write operations
 * are restricted to authenticated users to ensure data integrity.
 *
 * Data Structure:
 * The data is organized hierarchically. A top-level 'leagues' collection holds all
 * tournament documents. Each tournament document contains 'participants' (players) and 'matches' (games)
 * subcollections, creating a clear and isolated data tree for each tournament.
 *
 * Key Security Decisions:
 * - Public Read Access: All collections ('leagues', 'participants', 'matches') are configured
 *   to be publicly readable by anyone. This supports the primary use case of displaying
 *   tournament information on a website.
 * - Authenticated Writes: To protect data integrity, write operations (`create`, `update`, `delete`)
 *   are only allowed for users who are authenticated with the application (including anonymous users).
 *   This prevents unauthorized writes from outside the application context.
 * - No User-Specific Data: There are no user-specific collections (e.g., /users/{userId}),
 *   as the current model does not involve user accounts managing data.
 */
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    // =====================================================================
    // Helper Functions
    // =====================================================================

    // =====================================================================
    // Collection Rules
    // =====================================================================

    /**
     * @description Manages League (Tournament) documents, which are public to read but locked for writes.
     * @path /leagues/{leagueId}
     * @allow (read) Any user, signed in or not, can read tournament details.
     * @deny (write) No user can create, update, or delete a tournament as there is no ownership model.
     * @principle Public read access for general information, with writes disabled for security until an admin model is defined.
     */
    match /leagues/{leagueId} {
      allow read: if true;
      allow write: if false; // TODO: Add owner validation once the schema is updated with an ownership field.
    }

    /**
     * @description Manages Players in a tournament. Data is publicly readable. Writes are restricted to authenticated users.
     * @path /leagues/{leagueId}/participants/{participantId}
     * @allow (read) Any user can read player data.
     * @allow (write) Any authenticated user (including anonymous) can write player data.
     * @principle Public read access for display, with authenticated writes to prevent unauthorized modification.
     */
    match /leagues/{leagueId}/participants/{participantId} {
      allow read: if true;
      allow write: if request.auth != null;
    }

    /**
     * @description Manages Games in a tournament. Data is publicly readable. Writes are restricted to authenticated users.
     * @path /leagues/{leagueId}/matches/{matchId}
     * @allow (read) Any user can read game data.
     * @allow (write) Any authenticated user (including anonymous) can write game data.
     * @principle Public read access for display, with authenticated writes to prevent unauthorized modification.
     */
    match /leagues/{leagueId}/matches/{matchId} {
      allow read: if true;
      allow write: if request.auth != null;
    }
  }
}
