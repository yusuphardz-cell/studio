/**
 * This ruleset governs the Pool Game application's Firestore database.
 *
 * Core Philosophy:
 * The security model is designed for public read access. Write operations
 * are currently open to allow for prototyping and development.
 *
 * Data Structure:
 * The data is organized hierarchically. A top-level 'leagues' collection holds all
 * tournament documents. Each tournament document contains 'participants' (players) and 'matches' (games)
 * subcollections, creating a clear and isolated data tree for each tournament.
 *
 * Key Security Decisions:
 * - Public Read Access: All collections ('leagues', 'participants', 'matches') are configured
 *   to be publicly readable by anyone. This supports the primary use case of displaying
 *   tournament information on a website.
 * - Writes Enabled for Prototyping: To facilitate development, write operations
 *   (`create`, `update`, `delete`) are currently allowed. In a production environment,
 *   these rules would need to be updated with an ownership model to restrict writes
 *   to authorized users (e.g., tournament admins).
 * - No User-Specific Data: There are no user-specific collections (e.g., /users/{userId}),
 *   as the current model does not involve user accounts managing data.
 */
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    // =====================================================================
    // Helper Functions
    // =====================================================================

    // =====================================================================
    // Collection Rules
    // =====================================================================

    /**
     * @description Manages League (Tournament) documents, which are public to read but locked for writes.
     * @path /leagues/{leagueId}
     * @allow (read) Any user, signed in or not, can read tournament details.
     * @deny (write) No user can create, update, or delete a tournament as there is no ownership model.
     * @principle Public read access for general information, with writes disabled for security until an admin model is defined.
     */
    match /leagues/{leagueId} {
      allow read: if true;
      allow write: if false; // TODO: Add owner validation once the schema is updated with an ownership field.
    }

    /**
     * @description Manages Players in a tournament. Data is publicly readable and writable for prototyping.
     * @path /leagues/{leagueId}/participants/{participantId}
     * @allow (read, write) Any user can read and write player data.
     * @principle Public read/write access for prototyping. This should be secured in production.
     */
    match /leagues/{leagueId}/participants/{participantId} {
      allow read: if true;
      allow write: if true; // WARNING: Open access for prototyping. Secure this for production.
    }

    /**
     * @description Manages Games in a tournament. Data is publicly readable and writable for prototyping.
     * @path /leagues/{leagueId}/matches/{matchId}
     * @allow (read, write) Any user can read and write game data.
     * @principle Public read/write access for prototyping. This should be secured in production.
     */
    match /leagues/{leagueId}/matches/{matchId} {
      allow read: if true;
      allow write: if true; // WARNING: Open access for prototyping. Secure this for production.
    }
  }
}
